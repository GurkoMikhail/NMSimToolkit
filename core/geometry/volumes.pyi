import numpy as np
from typing import List, Any, Optional, Tuple, Union, Type, TypeVar, Sequence, Generic
from numpy.typing import NDArray
from core.geometry.geometries import Geometry
from core.materials.materials import Material, MaterialArray
from core.other.typing_definitions import Vector3D, Length, Precision

T = TypeVar('T')

class ElementaryVolume(Generic[Precision]):
    geometry: Geometry[Precision]
    material: Material
    name: str
    def __init__(self, geometry: Geometry[Precision], material: Material, name: Optional[str] = None) -> None: ...
    @property
    def size(self) -> Vector3D[Precision]: ...
    @size.setter
    def size(self, value: Vector3D[Precision]) -> None: ...
    def dublicate(self) -> 'ElementaryVolume[Precision]': ...
    def check_inside(self, position: Vector3D[Precision]) -> Union[bool, NDArray[np.bool_]]: ...
    def check_outside(self, position: Vector3D[Precision]) -> Union[bool, NDArray[np.bool_]]: ...
    def cast_path(self, position: Vector3D[Precision], direction: Vector3D[Precision]) -> Tuple[NDArray[Precision], 'VolumeArray']: ...
    def get_material_by_position(self, position: Vector3D[Precision]) -> MaterialArray: ...

class VolumeWithChilds(ElementaryVolume[Precision]):
    childs: List['TransformableVolume[Precision]']
    def __init__(self, geometry: Geometry[Precision], material: Material, name: Optional[str] = None) -> None: ...
    def add_child(self, child: 'TransformableVolume[Precision]') -> None: ...

class TransformableVolume(ElementaryVolume[Precision]):
    transformation_matrix: NDArray[np.float64]
    parent: Optional[VolumeWithChilds[Precision]]
    def __init__(self, geometry: Geometry[Precision], material: Material, name: Optional[str] = None) -> None: ...
    @property
    def total_transformation_matrix(self) -> NDArray[np.float64]: ...
    def convert_to_local_position(self, position: Vector3D[Precision], as_parent: bool = True) -> Vector3D[Precision]: ...
    def convert_to_local_direction(self, direction: Vector3D[Precision], as_parent: bool = True) -> Vector3D[Precision]: ...
    def translate(self, x: float = 0., y: float = 0., z: float = 0., inLocal: bool = False) -> None: ...
    def rotate(self, alpha: float = 0., beta: float = 0., gamma: float = 0., rotation_center: Sequence[float] = ..., inLocal: bool = False) -> None: ...
    def set_parent(self, parent: VolumeWithChilds[Precision]) -> None: ...

class TransformableVolumeWithChild(TransformableVolume[Precision], VolumeWithChilds[Precision]): ...

class VolumeArray(np.ndarray):
    element_list: List[Optional[ElementaryVolume]]
    @property
    def material(self) -> MaterialArray: ...
    def type_matching(self, type: Type[T]) -> NDArray[np.bool_]: ...
